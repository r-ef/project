<html>
    <head>
        <title>Company Homepage | Internly</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body class="darbody"> <!--class for dark appearance style-->

        <ul id="darnavbar">
            <li class="dir" id="logo"><a href="companyhome.html" target="_self"> <img src="website admin logo.png" height="50" width="auto" /></a> </li>
            <li class="dir" id="navtext"><a href="companyhome.html" target="_self">Home</a></li>
            <li class="dir" id="navtext"><a href="manageinternships.html" target="_self">Manage Internships</a></li>
            <li class="dir" id="navtext"><a href="manageapplications.html" target="_self">Manage Applications</a></li>
            <li class="log" id="navtext"><a href="home.html" target="_self">Log out</a></li>
            <li class="log" id="navtext"><a href="companyaccount.html" target="_self"><img src="profile icon.png" height="20" width="auto"/></a></li>
        </ul>
        <!--creating the navigation bar at the top of the page, both the logo and home button takes them to the same page. the log out and account buttons are to the
        right to make it easier to find them -->

        <div class="darbox">
        <h2 class="homep" id="welcomeMessage">Welcome back, [Company Name]!</h2>
        <p class="homep">You have x internship postings and x applications pending for approval.</p>
        </div>

<script>
// Load company profile on page load
document.addEventListener('DOMContentLoaded', function() {
    loadCompanyProfile();
});

// Fetch and display company profile
async function loadCompanyProfile() {
    try {
        const response = await fetch('http://localhost:3000/company/profile', {
            method: 'GET',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
        });

        if (response.status === 401) {
            window.location.href = 'companysignin.html';
            return;
        }

        if (!response.ok) {
            throw new Error(`Failed to load profile: ${response.status}`);
        }

        const company = await response.json();
        
        const welcomeMessage = document.getElementById('welcomeMessage');
        welcomeMessage.textContent = `Welcome back, ${company.name || 'Company'}!`;

    } catch (error) {
        console.error('Error loading company profile:', error);
    }
}

// Add logout functionality
document.querySelector('a[href="home.html"]').addEventListener('click', async function(event) {
    event.preventDefault();
    try {
        const response = await fetch('http://localhost:3000/company/logout', {
            method: 'POST',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        if (response.ok) {
            console.log('Logged out successfully');
        } else {
            console.error('Logout failed');
        }
    } catch (error) {
        console.error('Logout error:', error);
    }
    
    window.location.href = 'home.html';
});
</script>
    </body>
</html>