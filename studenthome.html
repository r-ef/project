<html>
    <head>
        <title>Student Homepage | Internly</title>
        <link rel="stylesheet" href="style.css">
    </head>
    <body class="ligbody"> <!--class for light appearance style-->

        <ul id="navbar">
            <li class="dir" id="logo"><a href="studenthome.html" target="_self"> <img src="website logo.png" height="50" width="auto" /></a> </li>
            <li class="dir" id="navtext"><a href="studenthome.html" target="_self">Home</a></li>
            <li class="dir" id="navtext"><a href="internshipslist.html" target="_blank">Internships</a></li>
            <li class="dir" id="navtext"><a href="studentapply.html" target="_self">Apply</a></li>
            <li class="dir" id="navtext"><a href="currentstudent.html" target="_self">Current Applications</a></li>
            <li class="log" id="navtext"><a href="home.html" target="_self">Log out</a></li>
            <li class="log" id="navtext"><a href="studentaccount.html" target="_self"><img src="profile icon.png" height="20" width="auto"/></a></li>
        </ul>
        <!--creating the navigation bar at the top of the page, both the logo and home button takes them to the same page. the log out and account buttons are to the
        right to make it easier to find them -->
        <div class="ligbox">
        <h2 class="homep" id="welcomeMessage">Welcome back, [Student Name]!</h2>
        <p class="homep">You have x applications in progress and x new internships have been posted.</p>
        </div>

<script>
// Load student profile on page load
document.addEventListener('DOMContentLoaded', function() {
    loadStudentProfile();
});

// Fetch and display student profile
async function loadStudentProfile() {
    try {
        const response = await fetch('http://localhost:3000/student/profile', {
            method: 'GET',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
        });

        if (response.status === 401) {
            window.location.href = 'studentsignin.html';
            return;
        }

        if (!response.ok) {
            throw new Error(`Failed to load profile: ${response.status}`);
        }

        const student = await response.json();
        
        // Update welcome message with student name
        const welcomeMessage = document.getElementById('welcomeMessage');
        const fullName = `${student.fname || ''} ${student.lname || ''}`.trim();
        welcomeMessage.textContent = `Welcome back, ${fullName || 'Student'}!`;

    } catch (error) {
        console.error('Error loading student profile:', error);
        // Keep default message if there's an error
    }
}

// Add logout functionality
document.querySelector('a[href="home.html"]').addEventListener('click', async function(event) {
    event.preventDefault();
    try {
        const response = await fetch('http://localhost:3000/student/logout', {
            method: 'POST',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json'
            }
        });
        
        if (response.ok) {
            console.log('Logged out successfully');
        } else {
            console.error('Logout failed');
        }
    } catch (error) {
        console.error('Logout error:', error);
    }
    
    window.location.href = 'home.html';
});
</script>
    </body>
</html>